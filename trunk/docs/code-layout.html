<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type" /><title>Delphi - Code Layout</title>

<link rel="stylesheet" type="text/css" href="stylesheets/delphi-docs.css" />
<!--
Last committed revision:
$Author$
$Date$
$Revision$
-->
</head>
<body>
<h1>Delphi: Code Layout</h1>
<div class="draftnote">
<p>This is a draft page, in ongoing development. It is still
rough, but
we are exposing it to the community
for review and to help anyone considering a Delphi deployment. We are
actively updating all of the documentation, so it is best to use this
resource online, rather than printing out a version.</p>
</div>
<p>This document describes the code layout - the hierarchical
organization of the
source code, configuration files, and other artifacts - of the Delphi
project,&nbsp;an open source
software system that helps open up access via the web to collections of
artifacts held by museums, historical societies, archeological
repositories and similar heritage institutions.<br />
</p>
For a closely related
discussion of the&nbsp;repository used to manage the code and other
artifacts for the Delphi project - in other words, where the files
described below can be found and downloaded - please see <a href="code-repository.html">Delphi: Code Repository</a>.
<h2>Organization of Delphi's code within the source tree<br />
</h2>
<span class="comment highlight">(At the moment, this is
nearly verbatim from Patrick Schmitz and has
had only minimal editing and additions. &nbsp;We need to augment
this with more detail about individual files or groupings of files, as
well as indicating which directories or sub-directories are pertinent
to each of Delphi's three components - collections browser, data
repository, and back-end tools.)</span><br />
<br />
The following is a description of how Delphi's source code,
configuration files, and other artifacts are organized under the source
code tree. &nbsp;(When using a Subversion client to access the <a href="code-repository.html">Delphi: Code Repository</a>,
all of the items below fall within a starting path in that repository
of <code>svn/trunk</code>, so that you would access the <code>/api</code> folder below, for
instance, via the repository path <code>svn/trunk/api</code>)<br />
<br />
<h3>{i.e. top level, not in any folder}</h3>
<dl>
<dt>.htaccess</dt>
<dd>A configuration file for Apache, containing a set of
directives to configure that web server. &nbsp;These directives
supplement those of the main Apache configuration file, <code>httpd.conf.</code><br />
<br />
Currently, the contents of this file consist of a set of RewriteRule
directives. &nbsp;These
take the relatively long URLs generated by Dephi's PHP code and
simplify them to shorter, hierarchical (and RESTful) URLs.
&nbsp;These shorter URLs are appended to the end of the Delphi base
URL (<code>/delphi</code>,
by default), which has been set in the <code>config.php</code>
file (see
<code>config.sample.php</code>, below), and are then
returned to the
visitor's browser.<br />
<br />
For instance, when Delphi's PHP code generates a long URL for a set of
artifacts, such as <code>/delphi/modules/sets/viewset.php?sid=5</code>,
this will be
rewritten to <code>/delphi/set/5</code>, the simplified,
shorter URL that
the visitor will actually see in their browser's address or location
bar.<br />
<br />
The directives in
this .htaccess file apply to all directories below this file's
location.
&nbsp;Thus, by placing these directives in a .htaccess file at the
top level of the Delphi source code tree, rather than in the main
Apache <code>httpd.conf</code>
file, this
permits a
different set of Apache directives to be used with individual test or
personal
instances of Delphi, each of which can be neatly contained in its own
folder.<br />
</dd>
<dt>config.sample.php</dt>
<dd>A configuration file for the PHP environment.<br />
<br />
In a new instance of Delphi, this file should be copied to a new file
named <code>config.php</code>, in the same
(top-level) directory. That new file should then be
customized as needed for that instance.<br />
<br />
This configuration file creates a PHP object named "<code>CFG</code>"
(for
"configuration"), which is then referenced via the
variable <code>$CFG</code> in many
locations throughout Delphi's PHP code.
&nbsp;This object contains the following data:<br />
<br />
<ul>
<li>Database type (e.g. 'mysql').</li>
<li>Database host and port.</li>
<li>Database name.</li>
<li>Related connection details.</li>
<li>The root HTTP URL for the Delphi collections browser
(e.g. 'http://myservername/delphi').</li>
<li>The short URL base for the browser (e.g. '/delphi').</li>
<li>HTTP path locations of various server files: the root
directory for the Delphi files, as well as for certain image
directories (thumbnails, mid-sized images, and tiled images that have
been prepared for zoom-and-pan access).</li>
<li>The default theme.</li>
<span style="font-family: Georgia,serif;"></span><li>Local
filesystem paths to various image directories and heavily used images
(e.g. 'no-image' placeholders).</li>
<li>The location of the Zoomify SWF file.</li>
<li>The size of derivative images, in pixels.</li>
<li>A contact email address.</li>
<li>A default web page title.</li>
</ul>
<br />
Currently, in the Delphi instance for PAHMA, the customized copies of
this file for the IST Unix Web Farm's development and quality assurance
tiers differ from the customized copy of this file for the Web Farm's
production tier in only three areas: the hostname and/or port of the
MySQL database server, the database name, and several related
connection details.<br />
<br />
</dd>
<dt>favicon.ico</dt>
<dd>A&nbsp;small icon that is displayed by some browsers in
windows/tabs and bookmarks when visiting the Delphi site.
&nbsp;(This is a binary file.)<br />
</dd>
</dl>
<h3>/api</h3>
<p>Includes various service calls that support both other php
logic as
well as some ajax calls.</p>
<dl>
<dt>apiSetup.php</dt>
<dd>Sets up the Delphi API: reading the PHP configuration file,
loads and includes the Pear MDB2 library (handler) within the current
PHP environment, and initiates a connection to
the database specified in the instance's configuration file (i.e. a
customized and renamed copy of the <code>config.sample.php</code>
file).
</dd>
</dl>
<p>Also includes some test files, like <code>catsInFacet.php</code>,
<code>catsForObjID.php</code>,
<code>test*.php</code>.<br />
</p>
<h3>/libs</h3>
Includes mostly imported libraries like jQuery, Smarty, PEAR (for the
MDB model), XPM (XPertMailer), and the Zoomify swf file. <br />
<br />
Also includes common libraries we developed to support ontology-related
functionality. <br />
<br />
<h3>/modules</h3>
Has the PHP files that provide most of the page functionality for
Delphi.<br />
<br />
The files are named for the respective functional areas, and should be
fairly self-evident. <br />
<br />
<h3>/ontologies</h3>
Is where we keep the ontologies used for each deployment.<br />
<br />
At this point, we only have PAHMA ontologies. Each facet is stored in a
separate file to simplify the maintenance, and there is a script to
merge these into the unified file. There is a document describing the
format<span style="font-family: monospace;">, </span><code>schema_notes.htm</code><br />
&nbsp;<br />
<h3>/schemas</h3>
Contains the SQL table creation scripts and related SQL utility scripts:<br />
<ul>
<li><code>mainObjInfo.sql</code> has most of the
tables we use, and is the
primary schema file.</li>
<li><code>delphi_ident.sql</code> has the
authentication and authorization
tables.</li>
<li><code>addBaseRolesAndPerms.sql</code> has an
init script for the basic
auth/authz info.</li>
<li><code>featured.sql</code> has the table for the
featured sets on the
PAHMA home page.</li>
<li><code>grants.sql</code> has a template for
setting up permissions on the
tables for the DB user you will use. It is just a template, and must be
customized for local username and passwords.</li>
<li><code>cat_counts.sql</code> defines tables and
the scripts to fill these
tables to support various UI features.</li>
<li><code>delphi_visit.sql</code> is not yet used.<br />
</li>
</ul>
<h3><br />
/themes</h3>
Includes the templates, script, CSS and static images used to produce
the actual HTML deployed on the site. This is deployment specific,
however many aspects could potentially be shared across deployments.
We'll need to consider how to better share this content at some point.<br />
<br />
The templates and the scripts are named for the functional areas of the
UI (and/or for the specific pages) they support. <br />
<br />
<span style="font-style: italic;">Future enhancements</span>:<br />
The CSS file is currently monolithic.<br />
There are a host of unused images we should clean up.<br />
<br />
<h3>/tools</h3>
Is the tree for the Java classes that make up the text analysis and
semantic indexing engine:<br />
<ul>
<li><code>MainApp.java</code> has the bulk of the
UI logic, and a fair
amount of application glue. It should be broken up more into clearer
modules that separate UI and application logic.<br />
</li>
<li><code>TaxoNode.java</code> and <code>Facet.java</code>
classes support the nodes in
an ontology, and facets.</li>
<li><code>ImagePathsReader.java</code> and <code>ImageInfo.java</code>
support the image
information for objects.</li>
<li><code>MetaDataReader.java</code> is a class
that simplifies the
processing of the collections metadata.</li>
<li><code>DumpColumnConfig.java</code> models the
info in the configuration
file that defines how we process a metadata dump.</li>
<li><code>VocabTermsReader.java</code> handles the
reading of a default
format for vocabularies - it is fairly specific to the TMS export
format, and may need additional attention for broader use.</li>
<li><code>DoubleHashTree.java</code> defines the
data structure that models
the terms and synonyms associated to concepts in the ontologies. It
includes support to initialize the data structure from the XML format
for the ontologies.</li>
<li><code>Counter.java</code>, <code>Pair.Java</code>,
<code>PriorityQueue.java</code>, and
<code>TextUtils.java</code> are various utility and
data structure classes.<br />
</li>
</ul>
</body></html>