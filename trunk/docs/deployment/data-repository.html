<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us"><head>
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type" /><title>Delphi - Deployment - Data Repository</title>

<link rel="stylesheet" type="text/css" href="../stylesheets/delphi-docs.css" />
<!--
Last committed revision:
$Author: aronroberts $
$Date: 2008-11-03 16:55:46 -0800 (Mon, 03 Nov 2008) $
$Revision: 386 $
-->
</head>
<body>
<p class="linkback right"><a href="introduction.html">Back
to Introduction</a></p>
<h1>Deploying Delphi: Data Repository</h1>
<div class="draftnote">
<p>This is a draft page, in ongoing development. It is still
rough, but we are exposing it to the community
for review and to help anyone considering a Delphi deployment. We are
actively updating all of the documentation, so it is best to use this
resource online, rather than printing out a version.</p>
</div>
<p>
This is an overview of the <span style="font-weight: bold;">data
repository</span> in Delphi, an
open source
software system that helps open up access via the Web to collections of
artifacts held by museums, historical societies, archeological
repositories and similar heritage institutions. &nbsp;Delphi uses
artificial intelligence and natural language processing to
make it more effective and enjoyable to find individual artifacts in
collections, and to uncover relationships between artifacts, than is
possible through traditional searching and browsing.
</p>
<h2>Types of data stored in the repository<br />
</h2>
The data repository stores two types of data:
<ul>
<li><span style="font-weight: bold;">Data about
artifacts in the collections ("metadata").</span><br />
<br />
<span style="font-style: italic;">Purposes of this data</span>:
&nbsp;This data is displayed when the Delphi collections browser
provides details about individual artifacts.<br />
<br />
Moreover, this data is "mined," via natural language processing, to
help build a set of concepts that more fully describe the collections
and to associate those concepts with each of the individual
artifacts in the collections. &nbsp;That allows the collections to
be searched and browsed by concepts.<br />
<br />
<span style="font-style: italic;">Source of this data</span>:
&nbsp;In the instance of Delphi used by PAHMA, data about the
artifacts in its collections ("metadata") comes
directly from that museum. &nbsp;The current format of this data is
in the form of "dump files," text files with comma-separated values.
&nbsp;These text files are generated from a selected set of
database tables that are used by the museum's collections management
system.<br />
<br />
Future instances of Delphi deployed elsewhere will also obtain
this metadata from their own museums or heritage
institutions. &nbsp;In any such instances, the format of this
metadata will be unique to the institution, depending both on how any
specific institution organizes the metadata about its collections, and
on the collections management system it uses to store
that data.<br />
<br />
As a result, the code and/or configuration of Delphi's back-end tools,
which load this metadata into the data repository, will need to be
customized for each instance. &nbsp;However, the database schemas
used to store this metadata in Delphi are relatively generic, and as
such either might
not need to be changed, or may require only minor customization.<span class="comment highlight"> &nbsp;Verify this last
assertion. &nbsp;Would this apply if Delphi were used for an art
museum, for
instance? &nbsp;Also, consider moving this paragraph elsewhere;
this may not be its most appropriate location.</span><br />
<br />
</li>
<li><span style="font-weight: bold;">Data about
the concepts associated with these artifacts (a
"semantic index").</span><br />
<br />
<span style="font-style: italic;">Purpose of this data</span>:
&nbsp;This data helps users of Delphi's collections browser locate
artifacts by concepts, and help uncover relationships between artifacts.<br />
<br />
<span style="font-style: italic;">Source of this data</span>:
This data is generated by Delphi's back-end tools, based on the
data provided by the museum, and then loaded into the repository by
those tools. &nbsp;
To learn more about these tools, see <a href="back-end-tools.html">Deploying
Delphi: Back-end Tools</a>.<br />
<br />
Future instances of
Delphi deployed elsewhere will need to build their own mental models
("ontologies") of their data facets and concepts.<br />
<br />
<span class="comment highlight"></span></li>
</ul>
<span class="comment highlight">Should we insert 'images
depicting the artifacts' as a second bullet point, above, or is this
simply a specialized form of metadata?</span>
<h2>Components</h2>
The data repository currently consists of the following components:<br />
<h3><strong>1. MySQL</strong></h3>
<p>The data repository for the instance of Delphi currently used
by PAHMA
is MySQL, an open source relational database management system (RDBMS).
&nbsp;MySQL is available in two flavors: MySQL Community Server
(free), the version used for Delphi; and MySQL Enterprise (commercial,
packaged with an enhanced set
of support services).<span class="comment highlight"><br />
</span><br />
<em>Obtained from</em>: <a href="http://www.mysql.com/" target="_blank">http://www.mysql.com/</a></p>
<p><em>Latest version (stable)</em>: 5.0.67</p>
<p><span class="comment highlight">Add details about
licensing, etc. here.</span></p>
<p><em></em>Delphi can also potentially use other
relational
database software in place of MySQL. &nbsp;This is because Delphi's
PHP-based code makes generic database calls via a PHP library,
Pear::MDB2, that supports a number of different types of databases.<br />
<br />
The Delphi team had considered other types of
data repositories, such as a "triple store" that is optimized for
storing
and retrieving semantic data represented via the Resource Description
Framework (RDF), but chose a relational database primarily on the basis
of
performance. &nbsp;That choice might be revisited at a future time,
if and when the performance of triple store repositories significantly
improves.<br />
</p>
<h4>1.1. MySQL on the IST Unix Web Farm</h4>
<p>In Delphi instance for PAHMA at UC Berkeley, MySQL is provided
by the IST Database team, as an extra-cost
option to the IST Unix Web Farm hosting environment.</p>
<p>Delphi uses the MySQL Basic service, which "is appropriate
for projects which have no restricted data, modest storage
requirements,
and no complex database design issues. It includes a single production
environment with limited support." &nbsp;For more information
regarding this service,&nbsp; see
<a href="http://ist.berkeley.edu/services/catalog/database/mysql" target="_blank">http://ist.berkeley.edu/services/catalog/database/mysql</a>
&nbsp;There are also other MySQL services available from the IST
Database team which offer
more support, at a higher cost.&nbsp;
</p>
<p>In the three-tier model of the IST
Unix Web Farm, it is
possible to have separate instances of databases, such as MySQL
databases, available to each of the tiers.&nbsp; This way,
development and quality assurance work that changes database contents
can be carried out without affecting the production database.
&nbsp;In the current instance of Delphi on the Web Farm, there are
two
instances of MySQL: one shared by the development and quality assurance
environments - since it was determined there was no compelling reason
to have separate database instances for those two tiers - and another
specific to the production environment.<br />
</p>
<span class="comment highlight">Add details about the Web
Farm tiers here, including </span><span class="comment highlight">how the PHP
environment is configured to point to specific MySQL database
instances across these tiers</span><span class="comment highlight">.<br />
</span>
<p><em>Installed version in Delphia's PAHMA instance:</em>
&nbsp;5.0.67<br />
(The installed version is selected and maintained by the
adminstrators
of the IST Unix
Web Farm. &nbsp;It was identified by running the 'mysql' utility
from
the command line, with a set of parameters to connect to the instance
of MySQL provided by the MySQL Basic service: <code>mysql --host=<span style="font-style: italic;">hostname</span>
--port=<span style="font-style: italic;">port_number</span>
--database=<span style="font-style: italic;">database_name</span>
--user=<span style="font-style: italic;">user_name</span>
--password=<span style="font-style: italic;">password</span></code>,
with values for each of these parameters obtained from the
configuration file <code>config.php</code>.
&nbsp;After connecting and receiving the interactive <code>mysql&gt;</code>
prompt, the following SQL command identified the MySQL version: <code>SHOW
VARIABLES LIKE "%version%";</code>)</p>
<h3><strong>2. phpMyAdmin</strong></h3>
<p>phpMyAdmin is an open source administration console for MySQL.
&nbsp;It provides a web-based, graphical interface to managing
accounts, databases, and tables, and other MySQL components.
&nbsp;phpMyAdmin is included as part of IST's MySQL Basic service.<br />
<br />
<span class="comment highlight">Add details about
versions, licensing, usage etc. here.<br />
</span></p>
<h3><strong>3. Image storage</strong></h3>
<p>Images - digital photographs or scans - have been created for
a
portion of the
artifacts in the PAHMA collection, and are retrieved and displayed by
Delphi's collections browser.</p>
<p>In
Delphi, images are currently retrieved by the PHP-based code in the
collections browser as files in a filesystem, rather than as binary
objects in a database.</p>
<h4>3.1. Image storage on the IST Unix Web Farm</h4>
<p>In the data repository for
the instance of Delphi currently used
by PAHMA,&nbsp;images are stored as files on a Storage Area Network
(SAN) in
the campus Data Center at UC Berkeley,
via a storage service provided by Information Services and Technology
(IST). &nbsp;The
Delphi
service is currently paying for 70
MB of SAN storage, and uses less than half of that storage, as of
2008-10-21.</p>
<p>
This SAN storage is mounted over the Data Center's network via the
Network File System (NFS) <span class="comment highlight">verify
this</span>, and is
made available to Delphi's 'pahma' account on the IST Unix Web Farm
through a
Unix symbolic link:<span style="font-family: &quot;Courier New&quot;,Courier,monospace;"></span>
the <code>webroot/delphi/objimages</code> directory within
that account
is actually a symlink to the NFS-mounted area of SAN storage that is
provided at&nbsp; <code>/nas/pahma/objimages</code>.</p>
<p>This SAN storage area is generally mounted read-only.
&nbsp;When it is necessary to add additional images, Delphi's
administrators make a request to the IST Unix Team to temporarily mount
this storage area as read-write.</p>
<p>
For
more details about the IST's storage services, including SAN storage
and network-accessible (NFS) access to that storage, see
<a href="http://ist.berkeley.edu/is/platforms/storage/san" target="_blank">http://ist.berkeley.edu/is/platforms/storage/san</a><br />
</p>
<h2><br />
The structure of data stored in the repository: database
schemas<br />
</h2>
<p><span class="comment highlight"></span>Delphi's
data repository primarily consists of a set of database tables.
&nbsp;These tables are categorized below by their broad purpose in
the repository, and are then listed alphabetically within each category.<br />
<br />
These tables are created using table creation scripts in the /schemas
directory of the Delphi source code tree. &nbsp;Most of these tables are
then populated with data by Delphi's set of back-end tools.<span class="comment highlight"></span><br />
</p>
<h3>Tables associated with data about artifacts in the collections ("metadata")</h3>
<p>The following tables contain the metadata about each artifact, and identify the media connected to that artifact.<br /><br />Each of these tables is created by the&nbsp;<code>/schemas/mainObjInfo.sql</code> script.</p>
<ul>
<li><span style="font-weight: bold;">media</span><br />
<br />
Identifies each of the available media objects <span class="comment highlight"></span>and their
associations with particular artifacts. &nbsp;This data includes
names and descriptions of each object (e.g. "Obverse
view," "Frontal view of object taken during restoration"), the image
(or multimedia preview) size, and the filesystem path to the media
object.<br />
<br />
In the Delphi instance for PAHMA, media currently consists only of
images, although audio and video types are defined.&nbsp; <span class="comment highlight">Verify
this.</span>&nbsp;<br />
<br />
</li>
<li><span style="font-weight: bold;">objects</span><br />
<br />
Contains
the core metadata about each artifact: its object number in the
collections, its name and description, and the filesystem path to its
default
image (de-normalized from the 'media' table to improve performance).<br />
<br />
In the Delphi instance for PAHMA, the "description is sourced from a
concatenation of several columns in the database that have been
determined to contain richer descriptive text."<br />
<br />
</li>
</ul>
<h3>Tables associated with the concepts associated with these artifacts (a "semantic index")</h3>
<p>The following tables maintain the mental model of the collections
("ontology"), and the association of concepts in that mental model with
each artifact.<br /><br />Each of these tables is created by the&nbsp;<code>/schemas/mainObjInfo.sql</code> script.</p>
<ul>
<li><span style="font-weight: bold;">categories</span><span style="font-weight: bold;"></span><br />
<br />
Maintains
the hierarchical set of concepts (aka "categories") that can be
associated with each artifact, as well as that concept's parent concept
and the facet it falls under. &nbsp;(A&nbsp;facet is a broad
top-level
category, such as "culture," "location," "materials," or "color.)<br />
<br />
</li>
<li><span style="font-weight: bold;">exclusions</span><span style="font-weight: bold;"></span><br />
<br />
Identifies the tokens (words or phrases) that, if found in the metadata
for an artifact, will cause that artifact to <span style="font-style: italic;">not</span> be associated
with a particular concept (aka category).<br />
<br />
</li>
<li><span style="font-weight: bold;">facets</span><br />
<br />
"Facets
define how we set up the caches and the annotations. &nbsp;A facet
includes
the facet name as well as policies for adding annotations using the
facet categories."<br />
<br />
<span class="comment highlight">Taken from the
comments in the table creation script, schemas/mainObjInfo.sql, and not
yet fully understood.</span><br />
<br />
</li>
<li><span style="font-weight: bold;">facetCaches</span><br />
<br />
"Facet Masks Cache all the categories from a facet that are associated
to a given image, as a sparse list of bitmasks."<br />
<br />
<span class="comment highlight">Taken
from the comments in the table creation script,
schemas/mainObjInfo.sql, and not yet fully understood. &nbsp;In
that script,
this table is given a 'dot notation,' NewPhotoDB.FacetCaches', which
may imply that this table is stored in a separate database
(?).&nbsp; <br />
<br />
</span></li>
<li><span class="comment highlight"></span><span style="font-weight: bold;">hooks</span><br />
<br />
Identifies
the tokens (words or phrases) associated with various categories
(concepts).<br />
<br />
If one or more of those tokens are found in the metadata for an
artifact, and there are no exclusions (see above), that will cause the
artifact to be associated with that particular
concept, via a record in the obj_cats table, below.<br />
<br />
</li>
<li><span style="font-weight: bold;">obj_cats</span><br />
<br />
The core table in the semantic index: associates categories with
artifacts in the collection. &nbsp;Includes flags that note the
reliability of these associations, and whether a particular association
of a category from an artifact may have been made automatically
("inferred").<br />
</li>
</ul>
<h3>Tables associated with user and curator annotations</h3>
<p>The following tables store informal, custom annotations - sets and
tags - that are made by&nbsp;by virtual visitors to the collections.
&nbsp;These annotations can be useful in supplementing the
institution's data about the artifacts in these collections
("metadata") and the association of concepts to artifacts ("semantic
index"). &nbsp;One type of sets - "featured" sets - are created by the
institution's curators, to help "invite people" into the collections. <br /><br />Each of these tables is created by the
<code>/schemas/mainObjInfo.sql</code> script, with one exception: the 'featured_sets' table is created by the <code>/schemas/featured.sql</code> script.</p>
<ul>
<li><span style="font-weight: bold;">featured_sets</span><br />
<br />
"Featured sets are shown on the first page" of Delphi's collections
browser "to invite people in." &nbsp;According to the comments in
the table creation script, "there should be about 6 of these" sets.<br />
<br />
Denormalized to improve performance, this table draws upon
previously-defined sets stored in the 'sets' table below.<br />
<br />
<span style="font-weight: bold;"></span></li>
<li><span style="font-weight: bold;">sets</span><br />
<br />
Maintains
lists of sets.&nbsp; Sets allow virtual visitors to the collections
to create and manage personal
groupings of artifacts, whether associated by topic or simply kept as
favorites.<br />
<br />
</li>
<li><span style="font-weight: bold;">set_objs</span><br />
<br />
Identifies the artifacts associated with a set. &nbsp;Sets allow
virtual visitors to the collections to create and manage personal
groupings of artifacts,&nbsp;whether associated by topic or simply
kept as
favorites.<br />
<br />
</li>
<li><span style="font-weight: bold;">tags</span><br />
<br />
Maintains
lists of tags.&nbsp; Delphi's "tags" feature allows virtual
visitors to the collections to assign 'tags' - meaningful words or
phrases of their own creation - to artifacts. &nbsp;<span class="comment highlight">Verify whether this is still
experimental.</span><br />
<br />
</li>
<li><span style="font-weight: bold;">tag_user_object</span><br />
<br />
Identifies
each instance where a virtual visitor to the collections ("user") has
assigned
a tag to a specific artifact. &nbsp;<span class="comment highlight">Verify whether this is still
experimental.<br />
</span></li>
</ul>
<h3>Tables associated with user roles and access permissions<br />
</h3>
<p>Each of these tables is created by the
<code>/schemas/delphi_ident.sql</code> script. &nbsp;A base set of
roles, permissions, and users, and the associations between them, is
then loaded into these tables by a second script.</p>
<ul>
<li><span style="font-weight: bold;">permission</span><br />
<br />
Defines permissions for the Delphi service.<br /><br />
</li>
<li><span style="font-weight: bold;">role</span><br />
<br />
Defines roles for the Delphi service.<br /><br />
</li>
<li><span style="font-weight: bold;">role_perms</span><br />
<br />
Associates one or more permissions to each role.<br /><br />
</li>
<li><span style="font-weight: bold;">user</span><br />
<br />
Identifies
each registered user of the Delphi service, including their username,
hashed password, email address, real name, and the status of their user
account.<br />
<br />
<span style="font-weight: bold;"></span></li>
<li><span style="font-weight: bold;">user_roles</span><br />
<br />
Associates one or more roles with each Delphi user.<span class="comment highlight"></span></li>
</ul>
<h3>Tables associated with utility functions</h3>
<p>This table is created by the&nbsp;<code>/schemas/mainObjInfo.sql</code> script, which also loads a minimal, initial set of data into that table. &nbsp;<span class="comment highlight">Identify how this table is later populated.</span></p>
<ul>
<li><span style="font-weight: bold;">DBInfo</span><br />
<br />
Holds system-wide&nbsp;parameters, such as the sizes of alternate
images and the version of this database schema.<br />
</li>
</ul>
<span class="comment highlight"><br />
Other tables: what is the purpose of the visit_request table, created
by schemas/delphi_visit.sql?<br />
<br />
All
tables created in MySQL using the .sql files in /trunk/schema currently
use the
default MyISAM storage engine,
http://dev.mysql.com/doc/refman/5.0/en/myisam-storage-engine.html
&nbsp;Determine where to best note this, and to discuss the
ramifications of using this storage engine versus the transactional
InnoDB engine, as per discussion with Patrick in early November 2008.
</span><br />
<span class="comment highlight"><br />
</span>
<h2>Related documentation</h2>
Delphi's data repository stores the data that is accessed by its
web-based collections
browser. &nbsp;To learn more about this collections browser, see <a href="collections-browser.html">Deploying Delphi:
Collections Browser</a>.<br />
<br />
Data is placed into this repository using a set of
back-end tools. &nbsp;
To learn more about these tools, see <a href="back-end-tools.html">Deploying
Delphi: Back-end Tools</a>.
<h2></h2>
</body></html>